<mat-card class="inward-main-card">
  <div class="row g-0">
    <!-- Sidebar -->
    <div class="col-md-3 stepper-sidebar p-4 text-white">
      <h5 class="text-center fw-bold mb-4">Inward Wizard</h5>

      <ul class="list-unstyled stepper-list">
        <li *ngFor="let s of steps"
            [attr.data-step]="s.num"
            [class.active]="step===s.num"
            [class.completed]="completedSteps.has(s.num)"
            (click)="goToStep(s.num)">

          <!-- Circle number or tick -->
          <div class="step-circle">
            <ng-container *ngIf="!completedSteps.has(s.num); else tick">
              {{s.num}}
            </ng-container>
            <ng-template #tick>
              <mat-icon>check</mat-icon>
            </ng-template>
          </div>

          <!-- Step label -->
          <span class="step-label">{{ s.label }}</span>
        </li>
      </ul>
    </div>

    <!-- Step Content -->
    <div class="col-md-9 p-4">
      <!-- Step 1 -->
      <div *ngIf="step===1">
        <mat-card class="inner-card">
          <h5 class="fw-bold text-primary mb-3">Incoming Messages</h5>

          <mat-table [dataSource]="messages" class="mat-elevation-z1">
            <ng-container matColumnDef="select">
              <mat-header-cell *matHeaderCellDef></mat-header-cell>
              <mat-cell *matCellDef="let m">
                <mat-checkbox (change)="toggleMsg(m.id)"></mat-checkbox>
              </mat-cell>
            </ng-container>

            <ng-container matColumnDef="id">
              <mat-header-cell *matHeaderCellDef>ID</mat-header-cell>
              <mat-cell *matCellDef="let m">{{m.id}}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="date">
              <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
              <mat-cell *matCellDef="let m">{{m.date}}</mat-cell>
            </ng-container>

            <ng-container matColumnDef="usd">
              <mat-header-cell *matHeaderCellDef class="text-end">USD</mat-header-cell>
              <mat-cell *matCellDef="let m" class="text-end">{{m.amountUSD}}</mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="columns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: columns;"></mat-row>
          </mat-table>
        </mat-card>

        <!-- Summary of selected messages -->
        <mat-card *ngIf="selectedIds.size > 0" class="inner-card mt-3">
          <h6 class="fw-bold text-secondary mb-2">Selected Messages Summary</h6>
          <div *ngFor="let m of selectedMessages()" class="border-bottom py-1">
            <span>ID: {{m.id}}</span> —
            <span>{{m.date}}</span> —
            <strong>USD {{m.amountUSD}}</strong>
          </div>
          <div class="fw-bold text-primary mt-2">
            Total USD: {{ reviewTotals().usdSum }}
          </div>
        </mat-card>

        <mat-card class="inner-card mt-3">
          <h6 class="fw-semibold">Select Rate Type</h6>
          <div class="d-flex gap-3 flex-wrap mt-2">
            <mat-radio-group [(ngModel)]="rateType" class="d-flex gap-3 flex-wrap">
              <mat-radio-button value="Online">Online</mat-radio-button>
              <mat-radio-button value="Card">Card</mat-radio-button>
              <mat-radio-button value="Dealer">Dealer</mat-radio-button>
              <mat-radio-button value="Order">Order Board</mat-radio-button>
            </mat-radio-group>
          </div>
          <button mat-flat-button color="primary" class="mt-3 fetch-btn" (click)="fetchRate()">
            Fetch Rate
          </button>
        </mat-card>

        <mat-card class="inner-card mt-3">
          <h6 class="fw-bold mb-2">Transaction Summary</h6>
          <div>Selected USD: {{ reviewTotals().usdSum }}</div>
          <div>Exchange Rate: {{ reviewTotals().exchangeRate | number:'1.2-2' }}</div>
          <div>GST: ₹{{ reviewTotals().gstINR }}</div>
          <div>Charges: ₹{{ reviewTotals().chargesINR }}</div>
          <div class="fw-bold text-primary mt-2">Total INR: ₹{{ reviewTotals().total }}</div>
        </mat-card>

        <div class="text-end mt-4">
          <button mat-flat-button color="primary" class="btn-next"
            (click)="next()" [disabled]="selectedIds.size===0">
            Next
          </button>
        </div>
      </div>

      <!-- Step 2 -->
      <div *ngIf="step===2">
        <mat-card class="inner-card">
          <h5 class="fw-bold text-primary mb-3">Select Account to Credit</h5>

          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Select Account</mat-label>
            <mat-select [(ngModel)]="selectedAccount">
              <mat-option *ngFor="let a of accounts" [value]="a.id">
                {{a.label}} (₹{{a.balance}})
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div class="text-end mt-4">
            <button mat-flat-button class="btn-prev me-2" (click)="prev()">Previous</button>
            <button mat-flat-button color="primary" class="btn-next"
              (click)="next()" [disabled]="!selectedAccount">
              Next
            </button>
          </div>
        </mat-card>
      </div>

      <!-- Step 3 -->
      <div *ngIf="step===3">
        <mat-card class="inner-card">
          <h5 class="fw-bold text-primary mb-3">Review & Confirm</h5>
          <pre class="bg-light p-3 rounded">{{ reviewTotals() | json }}</pre>

          <div class="text-end">
            <button mat-flat-button class="btn-prev me-2" (click)="prev()">Previous</button>
            <button mat-flat-button color="accent" class="btn-next"
              (click)="submit()">Submit</button>
          </div>
        </mat-card>
      </div>
    </div>
  </div>
</mat-card>

